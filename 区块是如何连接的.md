## 区块是怎么连接的？

在区块链和以太坊中，每个区块都连接着另外一个区块，区块依次相连，形成一条长链。其中第一个区块成为**创世区块**。创世区块通过`genesis.json`文件产生。  

区块链中，两个相邻的区块之间是父子的关系，并且是一对一的关系（每个子都只有一个父）。那么如何确认这种关系并且将他们连接在一起呢？  

每个区块都由两个部分组成，区块头和区块体。其中区块头存储着当前区块的特征值，它包含了很多属性，如生成该区块的时间，本区块的区块体的散列，上一个区块的散列...  

通过上一个区块的散列这一属性，我们就将区块连接在一起了，并且可以互相认证。由于散列的特殊性，如果区块体的内容改变，那么她的散列一定会改变，那么就会连锁性质的导致它的子块，和子块下面的所有块都要改变。而快速改变多个区块是几乎不可能的，这要求它占据全网51%的算力。这样的方式保证了区块链的不可篡改性质。  

## 区块体的散列值的产生-Merkle根数

区块头的哈希值是怎么产生的？答案是**Merkle根树**。  

Merkle根叔，又称哈希二叉树(Merkle tree)。每个被储存在区块里的交易都会产生一个散列值，每个交易都有自己的时间戳，在区块里他们会按时间顺序排序，然后挖矿程序会按照顺序将它们两个一组两个一组的分组，如果恰巧交易ID的总共数量为奇数个呢？那么排在最后的这个交易ID就copy自己一份，凑成偶数。每个组的两个成员的哈希值相连接成为一个长字符串，然后在对其产生哈希，然后不断重复分组-相连-产生哈希的过程，最终生成最后的一个哈希值，这就是**Merkle根哈希值(Merkle root)**。  

Merkle tree大部分都是二叉的，但是也有别的形式的，三叉及以上也是有可能的。  

### Merkle tree有什么用？

在说这个之前，我们要提一句另外一种产生一系列内容的哈希值的方式，Hash List。  

Hash List非常简单，就是对每一项内容都产生一个哈希，把这些哈希放进一个列表里，也就是Hash List，然后把这些哈希全都连接在一起，在对其产生一个哈希，用来检验Hash List。

通过Merkle tree这种方式产生哈希，在P2P网络下载整个网络之前，我们可以先从可信源获得Merkle root，然后从其他不可信源下载Merkle tree，对比二者的Merkle root，由于哈希值的唯一性，我们可以认为如果Merkle root一致，那么整个Merkle tree都是正确的。在获得整棵树后，我们就可以单独对树上的某只分支进行验证了。  

从网络上下载，需要先进行验证保证内容的正确可信，这也是Merkle tree和Hash List的意义之一。验证通过后才能进行下载。

Merkle tree和Hash List的主要区别在于，如果一部分内容损坏，Merkle tree的方式允许我们只下载这一部分数据所在的分支，然后验证这一个分支，验证通过后我们就可以开始下载内容了。Hash List则要求我们下载完整的Hash List才能验证。
